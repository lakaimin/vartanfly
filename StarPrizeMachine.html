<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ˜Ÿæ˜Ÿé»æ•¸çå“è²©è³£æ©Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- è®Šæ•¸ç³»çµ± --- */
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #bc13fe;
            --neon-green: #0aff0a;
            --glass-bg: rgba(20, 25, 40, 0.6);
            --glass-border: rgba(255, 255, 255, 0.15);
            --machine-bg: #0b101a;
            /* æ‰‹æ©Ÿç‰ˆåº•éƒ¨é¢æ¿é«˜åº¦é ç•™ */
            --mobile-panel-height: 320px; 
        }

        body {
            font-family: 'Rajdhani', 'Noto Sans TC', sans-serif;
            margin: 0;
            height: 100dvh; /* ä½¿ç”¨å‹•æ…‹è¦–å£é«˜åº¦ */
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* é˜²æ­¢æ•´å€‹ç¶²é å½ˆæ€§æ‹‰å‹• */
            color: white;
            background: radial-gradient(circle at 50% -20%, #1a1a2e, #000);
            background-size: 200% 200%;
        }

        /* èƒŒæ™¯æµå…‰å‹•ç•« */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(188, 19, 254, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.15) 0%, transparent 20%);
            z-index: -1;
            animation: bg-pulse 10s ease-in-out infinite alternate;
        }

        @keyframes bg-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        /* --- æ‰è½å‹•ç•« (ç‰©ç†å¼•æ“) --- */
        .falling-item {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transition: transform 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 0.8s ease-in;
            width: 100px;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }

        /* --- è²©è³£æ©Ÿå¤–æ®¼ --- */
        .vending-machine {
            width: 100%;
            max-width: 1000px;
            height: 95vh;
            background: var(--machine-bg);
            border-radius: 24px;
            box-shadow: 
                0 0 20px rgba(0, 243, 255, 0.3),
                0 0 60px rgba(188, 19, 254, 0.1),
                inset 0 0 50px rgba(0,0,0,0.8);
            display: flex;
            /* é—œéµï¼šè¨­å®š overflow hidden ç¢ºä¿å…§éƒ¨å·è»¸æ­£å¸¸é‹ä½œ */
            overflow: hidden; 
            position: relative;
            border: 2px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        /* --- å·¦å´ï¼šå•†å“æ«¥çª— --- */
        .left-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-right: 1px solid var(--glass-border);
            position: relative;
            min-height: 0; /* é—œéµï¼šé˜²æ­¢ Flex å­å…ƒç´ æº¢å‡º */
        }

        .window-frame {
            flex: 1;
            background: var(--glass-bg);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
            padding: 15px;
            
            /* æ²å‹•è¨­å®š */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•æ…£æ€§ */
            min-height: 0; /* é—œéµï¼šè®“æ²å‹•æ¢å‡ºç¾ */
        }

        .window-frame::-webkit-scrollbar { width: 6px; }
        .window-frame::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 20px;
            padding-bottom: 30px;
        }

        /* --- å•†å“å¡ç‰‡ --- */
        .item-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .item-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
            background: rgba(0, 243, 255, 0.05);
        }
        
        .item-img {
            width: 100%; height: 90px; object-fit: contain;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            transition: transform 0.3s;
        }
        .item-card:hover .item-img { transform: scale(1.1); }

        .price-tag {
            background: rgba(0,0,0,0.6);
            color: var(--neon-blue);
            font-family: 'Orbitron';
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue);
            margin-bottom: 8px;
            text-shadow: 0 0 5px var(--neon-blue);
        }

        .item-name {
            color: rgba(255,255,255,0.9);
            font-size: 0.85rem;
            text-align: center;
            height: 2.4em;
            line-height: 1.2;
            overflow: hidden;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px black;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .action-btn {
            width: 100%; padding: 8px 0; border-radius: 6px;
            font-size: 0.9rem; font-weight: 700; font-family: 'Rajdhani';
            cursor: pointer; border: none; transition: all 0.2s;
            position: relative; overflow: hidden;
            text-transform: uppercase; letter-spacing: 1px;
        }
        
        .btn-buy {
            background: transparent;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue), inset 0 0 5px rgba(0, 243, 255, 0.2);
        }
        .btn-buy:active { transform: scale(0.95); }
        .btn-disabled {
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: not-allowed;
        }

        /* --- å³å´ï¼šæ§åˆ¶é¢æ¿ --- */
        .right-panel {
            flex: 1; min-width: 320px;
            background: rgba(10, 15, 30, 0.9);
            display: flex; flex-direction: column;
            padding: 30px;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
            z-index: 50;
            border-left: 1px solid var(--glass-border);
            gap: 25px;
        }

        .lcd-container {
            background: #000;
            padding: 15px 20px;
            border-radius: 12px;
            border: 2px solid #333;
            box-shadow: inset 0 0 20px rgba(255, 0, 85, 0.2), 0 0 15px rgba(0,0,0,0.8);
            display: flex; justify-content: space-between; align-items: center;
            position: relative;
        }
        .lcd-container::after {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%; pointer-events: none; border-radius: 10px;
        }
        
        .lcd-label { color: var(--neon-pink); font-size: 0.8rem; letter-spacing: 2px; text-shadow: 0 0 5px var(--neon-pink); }
        .lcd-screen {
            color: var(--neon-pink);
            font-family: 'Orbitron', monospace;
            font-size: 2.8rem;
            text-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink);
            line-height: 1;
        }

        .coin-controls {
            display: flex; flex-direction: column; align-items: center;
            background: rgba(255,255,255,0.03);
            padding: 20px; border-radius: 16px;
            border: 1px solid var(--glass-border);
        }

        .quick-coin-row { display: flex; gap: 15px; margin-bottom: 20px; justify-content: center; width: 100%; }

        .quick-coin-btn {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: 2px solid #ffd700;
            color: #4a3b00;
            font-weight: 900; font-family: 'Orbitron'; font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            cursor: pointer; flex-shrink: 0;
            transition: all 0.2s;
        }
        .quick-coin-btn:active { transform: scale(0.9); box-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }

        .manual-input-row { display: flex; gap: 10px; justify-content: center; width: 100%; }
        
        .points-input {
            width: 140px; padding: 0 10px; height: 50px; font-size: 1.5rem;
            background: rgba(0,0,0,0.5); color: var(--neon-green);
            border: 1px solid var(--neon-green);
            border-radius: 8px; text-align: center; font-family: 'Orbitron';
            box-shadow: inset 0 0 10px rgba(10, 255, 10, 0.2);
        }
        .points-input:focus { outline: none; box-shadow: 0 0 15px var(--neon-green); }

        .insert-btn {
            background: var(--neon-green); color: #000; border: none;
            padding: 0 20px; border-radius: 8px; font-weight: 900; height: 50px;
            box-shadow: 0 0 10px var(--neon-green); cursor: pointer;
            font-family: 'Rajdhani'; font-size: 1.2rem;
            transition: all 0.2s;
        }
        .insert-btn:active { transform: scale(0.95); box-shadow: 0 0 20px var(--neon-green); }

        .desktop-footer { margin-top: auto; display: flex; justify-content: space-between; align-items: flex-end; width: 100%; }
        .return-lever { 
            width: 60px; height: 60px; border-radius: 50%; 
            background: #333; border: 2px solid #555;
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.3s; cursor: pointer;
        }
        .return-lever:active { transform: rotate(-45deg); }
        .return-lever svg { stroke: #aaa; }

        .pickup-slot-desktop { 
            height: 100px; background: #000; margin-top: 15px; border-radius: 12px; 
            border: 1px solid #333; display: flex; justify-content: center; align-items: flex-end; 
            box-shadow: inset 0 10px 30px rgba(0,0,0,0.9); position: relative; overflow: hidden;
        }
        .pickup-door { 
            width: 90%; height: 80%; background: linear-gradient(to bottom, #222, #111); 
            border-radius: 10px 10px 0 0; border-top: 1px solid #444; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            color: #555; font-weight: bold; font-family: 'Orbitron'; font-size: 1.2rem;
            transition: all 0.3s;
        }
        .pickup-door.has-item { 
            border-color: var(--neon-green); color: var(--neon-green); 
            box-shadow: 0 0 20px var(--neon-green); text-shadow: 0 0 10px var(--neon-green);
        }

        /* ======== ğŸ“± æ‰‹æ©Ÿç‰ˆ RWD æ ¸å¿ƒä¿®æ­£ ======== */
        @media (max-width: 850px) {
            body { align-items: flex-start; background: #050510; }
            
            .vending-machine { 
                height: 100%; 
                border: none; border-radius: 0; box-shadow: none; 
                flex-direction: column; 
                background: transparent; backdrop-filter: none;
                overflow: hidden; /* é˜²æ­¢çˆ¶å±¤æ²å‹• */
            }

            /* å·¦å´å•†å“å€ï¼šç¢ºä¿é«˜åº¦æ­£ç¢ºï¼Œå…è¨±å…§éƒ¨æ²å‹• */
            .left-panel { 
                flex: 1; 
                border-right: none; 
                padding: 15px; 
                background: transparent;
                /* é—œéµä¿®æ­£ï¼šé ç•™åº•éƒ¨ç©ºé–“çµ¦å›ºå®šé¢æ¿ */
                padding-bottom: calc(var(--mobile-panel-height) + 20px); 
                overflow: hidden; /* è®“å­å…ƒç´  window-frame è² è²¬æ²å‹• */
                display: flex;
                flex-direction: column;
                min-height: 0; /* Flexbox æº¢å‡ºä¿®æ­£ */
            }

            .window-frame { 
                background: rgba(255,255,255,0.03); 
                border: none; box-shadow: none; padding: 5px; 
                height: 100%; /* å¡«æ»¿ left-panel */
                overflow-y: auto; /* ç¢ºä¿å¯ä»¥æ»‘å‹• */
            }

            .pickup-slot-desktop, .desktop-footer { display: none; }

            /* å³å´æ§åˆ¶é¢æ¿ï¼šå›ºå®šåœ¨åº•éƒ¨ */
            .right-panel {
                position: fixed; bottom: 0; left: 0; width: 100%; height: auto;
                background: rgba(10, 15, 30, 0.95);
                backdrop-filter: blur(15px);
                border-top: 1px solid var(--neon-blue);
                box-shadow: 0 -10px 40px rgba(0, 243, 255, 0.2);
                padding: 20px; padding-bottom: calc(20px + env(safe-area-inset-bottom));
                gap: 15px; flex: none; align-items: center;
            }

            .lcd-container { width: 100%; padding: 8px 15px; margin-bottom: 5px; background: rgba(0,0,0,0.6); }
            .lcd-screen { font-size: 2.5rem; }
            
            .coin-controls { background: transparent; border: none; padding: 0; width: 100%; }
            .quick-coin-row { margin-bottom: 12px; gap: 20px; }
            .quick-coin-btn { width: 55px; height: 55px; font-size: 0.9rem; }

            .manual-input-row { width: 100%; justify-content: center; }
            .points-input { width: 140px; height: 45px; font-size: 1.3rem; }
            .insert-btn { height: 45px; width: 80px; font-size: 1rem; }

            .mobile-return-container { position: absolute; top: -70px; right: 20px; z-index: 60; }
            .return-lever-mobile { 
                width: 50px; height: 50px; background: rgba(0,0,0,0.8); 
                border: 2px solid var(--neon-pink); border-radius: 50%; 
                display: flex; justify-content: center; align-items: center; 
                box-shadow: 0 0 15px var(--neon-pink);
                backdrop-filter: blur(5px);
            }
            .return-lever-mobile svg { stroke: var(--neon-pink); }
        }

        /* å½ˆçª—æ¨£å¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(10px); }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal-content { 
            background: rgba(20, 25, 40, 0.95); 
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.3);
            padding: 30px; border-radius: 20px; text-align: center; width: 85%; max-width: 350px; transform: scale(0.9); transition: transform 0.3s; color: white;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-title { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); font-family: 'Orbitron'; margin-bottom: 10px; }
        .modal-btn { background: var(--neon-blue); color: black; font-weight: bold; padding: 12px; width: 100%; border-radius: 8px; margin-top: 20px; font-family: 'Orbitron'; box-shadow: 0 0 15px var(--neon-blue); transition: transform 0.2s;}
        .modal-btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div class="vending-machine">
        <div class="left-panel">
            <div class="window-frame">
                <div class="grid-container" id="machine-grid"></div>
            </div>
            <div class="pickup-slot-desktop">
                <div id="pickup-door" class="pickup-door" onclick="checkPickup()">PUSH</div>
            </div>
        </div>

        <div class="right-panel">
            <div class="mobile-return-container md:hidden">
                <div onclick="resetMoney()" class="return-lever-mobile">
                     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                </div>
            </div>

            <div class="lcd-container">
                <span class="lcd-label">CREDIT<br>é¤˜é¡</span>
                <div id="balance-display" class="lcd-screen">0</div>
            </div>

            <div class="coin-controls">
                <div class="quick-coin-row">
                    <button class="quick-coin-btn" onclick="addPoints(10)">+10</button>
                    <button class="quick-coin-btn" onclick="addPoints(50)">+50</button>
                    <button class="quick-coin-btn" onclick="addPoints(100)">+100</button>
                </div>

                <div class="manual-input-row">
                    <input type="number" id="user-points" class="points-input" placeholder="0" onkeypress="handleEnter(event)">
                    <button onclick="addManualPoints()" class="insert-btn">IN</button>
                </div>
            </div>

            <div class="desktop-footer hidden md:flex">
                <div class="text-xs text-gray-500" style="font-family: Orbitron;">ID: NEON-2077</div>
                <div onclick="resetMoney()" class="return-lever">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <div id="reward-modal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="text-6xl mb-4" style="filter: drop-shadow(0 0 10px white);">ğŸ</div>
            <h2 class="text-2xl font-black mb-2 modal-title">ACQUIRED!</h2>
            <div class="bg-black/50 rounded-lg p-4 mb-4 border border-white/10">
                <img id="modal-img" src="" class="w-40 h-40 object-contain mx-auto">
            </div>
            <h3 id="modal-name" class="text-xl font-bold text-white mb-2">å•†å“åç¨±</h3>
            <p class="text-gray-400 mt-2 font-bold text-sm">REMAINING CREDIT</p>
            <div class="text-pink-500 text-3xl font-mono font-bold" id="modal-balance" style="text-shadow: 0 0 10px #ec4899;">0</div>
            <button onclick="closeModal()" class="modal-btn">
                COLLECT ITEM
            </button>
        </div>
    </div>

    <script>
        const initialItems = [
            { id: 1, name: "å…’ç«¥é»åœŸ", price: 150, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjH6JH2Moe1-UnUoSTspzm62HyPyFMFcKZRjfBn8m8-vTuQVvQeJcVlgdS_XPBmrJaDfwVi_f4-JlCKg0bczYF7UxRtVQCd3x6fIzFd4Yckcn9jYtsfLAlK26kQ_ikNZ5CZVSURsPwcPfPnwYGv00PCr2fiPJLuSj5n0r8OoMlIp63tH0lA_1_onkL5/s16000/%E5%85%92%E7%AB%A5%E9%BB%8F%E5%9C%9F.webp" },
            { id: 2, name: "é™æ§ç‰¹æŠ€è»Š", price: 3000, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbj4596hitk8w13O0b6CfQZ2jknBEb0-tG6pByf6kLTDTPPoVC8KYIZIxo07fE7eq3gFdYaOjny1ilPdcO633rCGRDky0CIk4afwFkqiqwGLrVRzYZt4At5YshjfgwC_l2IfQNXT0kkQd79hy3u7IsIq9zI67xmlXVpFt04yOTvLJ0xkx1htnGxIuZ/s16000/%E9%81%99%E6%8E%A7%E7%89%B9%E6%8A%80%E8%BB%8A.webp" },
            { id: 3, name: "ç©æœ¨æŒ–åœŸæ©Ÿ", price: 150, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjn6BCJBkLeXyNmBC0YZxRbt29d4-aDIkf0dgIN6Jgh3qfFuiZb8AF6Xd-SKDbIPw-J_miEQzczwR8T78PvArFaEPx0JyjbYiiPebTdokcMmCG6DV_wOwR1lChqj6zsh77j58aO4gJgS3W4INYlLG-Bg5dU5VzS4dLgzokP_H79UiJ18ZhfNQkZuC8A/s16000/%E7%A9%8D%E6%9C%A8%E6%8C%96%E5%9C%9F%E6%A9%9F.webp" },
            { id: 4, name: "å¤§é±·é­šå¤¾å¤¾æ¨‚", price: 200, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAmHKEfryJ85bklwtLu5eniecEYTVXZOYYZrMV8cTGcZ2va9AzuEF0RG5jzsIPu_7u9LhvHEZBQKSHOukKUcMVwYuK2ncek2PhwUi3Ge0OLMjzsdNQDxDTTtfpwFgWMujRn_tVxea7C2QphuL4aTOW3FCn0yL6UPNWhLOOs0HXmCDRTqp8rOPE0FrW/s16000/%E5%A4%A7%E9%B1%B7%E9%AD%9A%E5%A4%BE%E5%A4%BE%E6%A8%82.webp" },
            { id: 5, name: "è Ÿç­†å°æ–°ç›¸æ¡†", price: 1000, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4EmBgYWwK2MDphMBjx7yQegh4Fmz9mMu9aKqPoqo7QJjjtVvn6GuhAlrvDmZMwqYYxYWcEzf-xxpMHJBJlAnEcQPv5Iykgl5B7RIPJrti0gLl09VSt_fsg_lSCaflfmKbcQaDfJag3Z_JCDj-AqR281Z8h27YtVK6BwUl1X96cBU46-lctIE1lrjB/s16000/%E8%A0%9F%E7%AD%86%E5%B0%8F%E6%96%B0%E7%9B%B8%E6%A1%86.webp" },
            { id: 6, name: "å¡é€šé˜²èšŠæ‰‹ç’°", price: 200, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQuV7GJNjvr4_446SCKmK2vLauyvtMQTP13dkYVMfg_Gf-40wAAGzS6hVvFVf_1dHkg902GhhOcZEHYnCjKrXzMEdlKC1MKiSZikuF13KgZD0TIaq1G8YWdtA4FZ_tI4B94pN8lnQbpsK93fvfI8-F7LnE_zhAN_43GRWAs5AMB0hyphenhyphenlJqIhOQIwSyT/s16000/%E5%8D%A1%E9%80%9A%E9%98%B2%E8%9A%8A%E6%89%8B%E7%92%B0.webp" },
            { id: 7, name: "å¤šåŠŸèƒ½æ•¸å­¸å°º", price: 300, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghIkvFn9_6-lm7C00GwDJ_ngd7tQbEM5NKaGYooPvJB-O-KsRP0GGllyXtdznXn_u1H71Mq_f_xdl7lSMF0eLfqRW5KYOtR3_UvKI4poB6ccA4B3uhcZvNpLiC08doV1UrD4ryOj8M5WT7cGuJcLuqreQjHnR83zpyJJyDDmFIAOs6S6AY3iTnfLAB/s16000/%E5%A4%9A%E5%8A%9F%E8%83%BD%E6%95%B8%E5%AD%B8%E5%B0%BA.webp" },
            { id: 8, name: "æŸ”é †è­·é«®æ¢³", price: 500, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiNHbpDSpaopobo_tsmwb4N2o5jaYWAnps29FH9j127fPexql6KfdXOp4mb7HZvFbghW8madFMWTr9AZeWp8NPJgrH4GYYEOR681466Bt4_3YpfvesUuK0iShDR8f1_QjgLeh6RODfxdxKcDn1IXxrT1Z3nuwmw326QBhRk4uS-LuYdi0m41rHZ8DKz/s16000/%E6%9F%94%E9%A0%86%E8%AD%B7%E9%AB%AE%E6%A2%B3.webp" },
            { id: 9, name: "ç•¢å¡ç´¢æ°´å½©ç•«ç­’", price: 500, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgpsyQK4aVYm-awZWmnshX5mDaLfIJUqy1-jaHKyZhKdPbbD5uppUV-kJTQqELZv_B1lbBilrq2rWWnzxDdjvTHOagzVtNfaCWGuCyntselHE_Z6hazZe5bCBl3qnB0LWt0HMjZ8S8bAQmgbxC_e6SCN-l-oeWLP3qPMOgwQXgBanO4FOgsYgTQKCI6/s16000/%E7%95%A2%E5%8D%A1%E7%B4%A2%E6%B0%B4%E5%BD%A9%E7%95%AB%E7%AD%92.webp" },
            { id: 10, name: "å‰åˆ©å¡å“‡å°ç« ", price: 150, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhebqSlgr0uox3_d8UmDK3BcIPVlhyphenhyphenLc_Bq3dOIoSKQCmGWApe75y7h1yzhmTED5_-PjpzRyE06JpnkKRivAOOGAJT9xMOHD8os0KMpk2kcg7ipvpESnFka-LHckkgWLF8HRUs7nKpQa3hpykISGgeppv__1Kv3knu1isUl7-VSoW5O9RFkt21BgA-3/s16000/%E5%90%89%E5%88%A9%E5%8D%A1%E5%93%87%E5%8D%B0%E7%AB%A0.webp" },
            { id: 11, name: "é­”ç´™é›»è·¯", price: 200, stock: 2, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhE6WE-kA9Ouw6PPTaBt7ElODmn6J002f39TOOk1VE-xmiJmewa9ButFXblh-7txDKIK8GR_4DVS2FAwYEXA51GnC5ikpej4s8CQ7GtZzB8iC_XSfcr8TOK2j8QTOVP1ec_6Iegi_umzIpjAlCbRMrbPCPoq87OjQ0QfBtqV8XgC_kOUNXyORjAEOci/s16000/%E9%AD%94%E7%B4%99%E9%9B%BB%E8%B7%AF1%E8%99%9F.webp" },
            { id: 12, name: "æµ·æ´‹ç”Ÿç‰©æ‰­è›‹", price: 120, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhN-vMQKIrDgAj4QPtFA7dElc3W9_d1K4TkYNzVENc79FMhyphenhyphenld-ud5ThcUa15S9pRr3HiBmTa1s8MGLQwiD9jDh7M4E1XOEeMpbSuDvc_LcAfi7EXHTedXgok1eFBBGpOWfwOvhqWf_AREY1bMm3QVfR_1o3OgK09K8EpJvLp11LMaPqaAN-yMo3Twy/s16000/%E6%B5%B7%E6%B4%8B%E7%94%9F%E7%89%A9%E6%89%AD%E8%9B%8B.webp" },
            { id: 13, name: "ä¸‰éº—é·—å°ç›¤å­", price: 200, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYBWZCvZTFSOYwjJhFdnxedDiqTg7CkkjwWeK-CW_XxUrzUGpgnx-F_xTLecZWde7V3Cv4BeBCf-hoBbZ6sWfuKLYXTnhfSIYlPs-6OzmYVQ7kToA4r120x24ypymg_0YKz92LgeY1qr8VxYNa3LpADlYBvwpoQ43niKReFM6RmyJFJdCcHkvesk69/s16000/%E4%B8%89%E9%BA%97%E9%B7%97%E5%B0%8F%E7%9B%A4%E5%AD%90.webp" },
            { id: 14, name: "ç‚«è®Šä¹‹ç‹", price: 300, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiPHj-MC5kdoNqbTmotAFipjDfcP_dEd3I_ThRpS3eiDbjhlt8UzwftjrxKT7jmBJhq6qXVYHAfdHeJU0c5D1AO73QS-CfLO8OwlhOYGCiaInUs6UopvKlTnujx_KXNNVIsVxPQIvGaCditd94-DkYSQdUuvFExSpRm4NeAr7wWDv4LhKTtLvJyN0a/s16000/%E7%82%AB%E8%AE%8A%E4%B9%8B%E7%8E%8B.webp" },
            { id: 15, name: "å¤§è€³ç‹—æ‰‹éŒ¶", price: 500, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjwm6a2-GWMptPtEla-yd6bvsML7FJ1-9Co3xB8H5D-u-0yLUzwtrpnlX8IadqN8B_0MQzcdXQs_L-sbssDQeE6gtJUo4imU_iOycYXAtQPwf9w4qGmY8qh1WekVj87yIRN4LghHD4lJfIGwWmQkbF5nEQCyNhqiYkhLp9tMzRe8nML-T0SD7byI5Q_/s16000/%E5%A4%A7%E8%80%B3%E7%8B%97%E6%89%8B%E9%8C%B6.webp" },
            { id: 16, name: "é…·è—é‹å‹•æ‰‹éŒ¶", price: 500, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhLgw5KQ_Ylg1ZRyV_zKa0QK6FLmZfbxOB7NcUBcL5w79LtT6TxCP-aotCfqiXHcceEsXkivResVggp-zsBW1gLeFFZ4OZHc2VHrFmn6qTR7569YM4-8xbX14klAoEWdACq9nTMEXfez5RUjWp-dkloLGK4DSkfjuEg3nEL_vZgs7S7wCUbDID44T_5/s16000/%E9%85%B7%E8%97%8D%E9%81%8B%E5%8B%95%E6%89%8B%E9%8C%B6.webp" },
            { id: 17, name: "å‰åˆ©å¡å“‡ç©æœ¨", price: 300, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbiyqHkUz0z5iXOZ_7h8OiszrVQPaxMogvC-nvIqe-kT9F8nzNs_zVSvpyroEByKTsdQ_WJCLjRCTIKqAUfShaaEbTjOZnBh307iTE2fW7BaZmfFDQkS_PBTcXhlOcct-yzYggvA4Q7LYqAUjLO0B-epGbtAz1q8j_TlbGQhGL0Gv1ugkYnOMLBTBd/s16000/%E5%90%89%E5%88%A9%E5%8D%A1%E5%93%87%E7%A9%8D%E6%9C%A8.webp" },
            { id: 18, name: "å¤§é˜ªè˜‘è‡é ­å°è»Š", price: 800, stock: 1, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh9acKCFH0EoDK6oo1oeEuNIhK8mUkQbsSs9j1jahTs-JS3IgK7MYZKniXU2_eXFiclqO-01O77C5SkKoBfGaz-MxyGPqCxioHiclUkV3NHGmE167uwwLpOWJpTisQz8tHy7FpyH6qs7dXKL9ZjxFdVTaAkC52H5rcS3T65OBwycCsiPsVzzQod9lnr/s16000/%E5%A4%A7%E9%98%AA%E8%98%91%E8%8F%87%E9%A0%AD%E5%B0%8F%E8%BB%8A.webp" },
            { id: 19, name: "çˆ¸çˆ¸æŠ±æŠ±5åˆ†é˜åˆ¸", price: 50, stock: 5, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgnttmoRPYZHWq0tvf4N4qncnGTBZr46uQ2C_1aZDPHNjzrQtcFOsIARqaNl5T5ATQFlqqPEh89aHslOhgMgUS5dCxsWgWOxTEuJ2Vnhhk4aS53P7cD5TZDFFq5CDzT8tyVYArk2U4AsMDnB9aCaHCn1MwWM1kILBmWSYzGYhjRKT-VzE59CJStQr02/s16000/%E7%88%B8%E7%88%B8%E6%8A%B1%E6%8A%B1%E5%88%B8.webp" },
            { id: 20, name: "åª½åª½ä¸ç”Ÿæ°£1ä»¶äº‹åˆ¸", price: 80, stock: 5, img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg6M2QIqNC0VLquofkz-LIlcgiGF2xmtEw7QbWtZKzw0OA_kfPku10Zy0Bz5vu2SFP57lHiWFyqanMzrdyaan42uXVtwOutNK-I_fNfdGaNmKkIMNIvsfBuMGgCEW212kgqj0E9oBG2IiFvp__dh5slM1v4RIWNPiIDozJMQKoKg4s3CZocXT3jEYXv/s16000/%E5%AA%BD%E5%AA%BD%E4%B8%8D%E7%94%9F%E6%B0%A3%E5%88%B8.webp" }
        ];

        let items = JSON.parse(localStorage.getItem('vm_items')) || initialItems;
        let currentBalance = parseInt(localStorage.getItem('vm_balance')) || 0;
        let pendingReward = null;

        const grid = document.getElementById('machine-grid');
        const balanceDisplay = document.getElementById('balance-display');
        const inputField = document.getElementById('user-points');
        const pickupDoor = document.getElementById('pickup-door');
        const modal = document.getElementById('reward-modal');

        function init() {
            renderItems();
            updateBalanceUI();
        }

        function saveState() {
            localStorage.setItem('vm_items', JSON.stringify(items));
            localStorage.setItem('vm_balance', currentBalance);
        }

        function renderItems() {
            grid.innerHTML = '';
            items.forEach((item, index) => {
                const isSoldOut = item.stock <= 0;
                const canAfford = currentBalance >= item.price;
                
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <div class="price-tag">${item.price} CR</div>
                    <img id="img-${index}" src="${item.img}" class="item-img" onerror="this.src='https://via.placeholder.com/150/000000/FFFFFF?text=NO+IMG'">
                    <div class="item-name">${item.name}</div>
                    <button class="action-btn ${isSoldOut ? 'btn-disabled' : (canAfford ? 'btn-buy' : 'bg-gray-800 text-gray-500 border border-gray-600')}" 
                            onclick="purchase(${index})" 
                            ${isSoldOut ? 'disabled' : ''}>
                        ${isSoldOut ? 'SOLD OUT' : (canAfford ? 'BUY' : 'LOCKED')}
                    </button>
                    <div class="text-[10px] text-gray-400 mt-1">QTY: ${item.stock}</div>
                `;
                grid.appendChild(card);
            });
        }

        function updateBalanceUI() {
            balanceDisplay.innerText = currentBalance;
            renderItems();
            saveState();
        }

        function addPoints(amount) {
            playAudio('coin');
            currentBalance += amount;
            updateBalanceUI();
        }

        function addManualPoints() {
            const val = parseInt(inputField.value);
            if (val > 0) {
                addPoints(val);
                inputField.value = '';
            }
        }

        function handleEnter(e) { if(e.key === 'Enter') addManualPoints(); }

        function resetMoney() {
            if (currentBalance > 0) {
                playAudio('return');
                currentBalance = 0;
                updateBalanceUI();
            }
        }

        function purchase(index) {
            const item = items[index];
            if (currentBalance >= item.price && item.stock > 0) {
                currentBalance -= item.price;
                item.stock--;
                pendingReward = item;
                playAudio('button');
                updateBalanceUI();

                // ç‰©ç†æ‰è½å‹•ç•«
                const originalImg = document.getElementById(`img-${index}`);
                if (originalImg) {
                    const rect = originalImg.getBoundingClientRect();
                    const clone = originalImg.cloneNode(true);
                    clone.className = 'falling-item';
                    clone.style.top = rect.top + 'px';
                    clone.style.left = rect.left + 'px';
                    clone.style.width = rect.width + 'px';
                    
                    document.body.appendChild(clone);
                    void clone.offsetWidth;

                    const dropY = window.innerHeight + 100;
                    const rotate = Math.random() * 60 - 30;
                    const moveX = Math.random() * 40 - 20;
                    
                    clone.style.transform = `translate(${moveX}px, ${dropY - rect.top}px) rotate(${rotate}deg)`;
                    clone.style.opacity = '0';

                    setTimeout(() => { clone.remove(); }, 800);
                }
                
                setTimeout(() => {
                    playAudio('drop');
                    if(window.innerWidth <= 850) {
                        showModal(pendingReward);
                        fireConfetti();
                        pendingReward = null;
                    } else {
                        pickupDoor.classList.add('has-item');
                    }
                }, 600);
            } else {
                playAudio('error');
            }
        }

        function checkPickup() {
            if (pendingReward) {
                playAudio('success');
                showModal(pendingReward);
                fireConfetti();
                pickupDoor.classList.remove('has-item');
                pendingReward = null;
            }
        }

        function showModal(item) {
            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-name').innerText = item.name;
            document.getElementById('modal-balance').innerText = currentBalance;
            modal.classList.add('show');
        }

        function closeModal() {
            modal.classList.remove('show');
        }

        function fireConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#00f3ff', '#bc13fe', '#ffffff'] });
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playAudio(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'coin') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(2000, now); osc.frequency.exponentialRampToValueAtTime(3000, now+0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now+0.1);
                osc.start(now); osc.stop(now+0.1);
            } else if (type === 'drop') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(100, now); osc.frequency.linearRampToValueAtTime(40, now+0.4);
                gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now+0.4);
                osc.start(now); osc.stop(now+0.4);
            } else if (type === 'button') {
                osc.type = 'square'; osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now); gain.gain.linearRampToValueAtTime(0, now+0.1);
                osc.start(now); osc.stop(now+0.1);
            } else if (type === 'success') {
                const notes = [523, 659, 783, 1046, 1318]; // C Major Sci-fi style
                notes.forEach((f,i) => {
                    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'sine'; o.frequency.value = f;
                    g.gain.setValueAtTime(0.05, now+i*0.08); g.gain.exponentialRampToValueAtTime(0.001, now+i*0.08+0.5);
                    o.start(now+i*0.08); o.stop(now+i*0.08+0.5);
                });
            } else if (type === 'return') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(200, now); osc.frequency.linearRampToValueAtTime(100, now+0.2);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now+0.2);
                osc.start(now); osc.stop(now+0.2);
            } else if (type === 'error') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, now);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now+0.2);
                osc.start(now); osc.stop(now+0.2);
            }
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>