<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹ä¹ä¹˜æ³•æ¥µé€ŸæŒ‘æˆ°æ¨¡å¼</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body {
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: #ffecd2;
            background-image: linear-gradient(120deg, #ffecd2 0%, #fcb69f 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        .game-container {
            background-color: white;
            padding: 25px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            width: 90%;
            max-width: 420px;
            position: relative;
            border: 5px solid #fff;
        }

        /* ç¸½æ™‚é–“æ¿ */
        .total-timer-board {
            background-color: #3498db; /* è—è‰² */
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 15px;
            display: inline-block;
            box-shadow: 0 4px 0 #2980b9;
        }
        #total-time {
            font-size: 24px;
            margin-left: 5px;
        }

        /* é–‹å§‹ç•«é¢çš„é®ç½© */
        #start-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #start-btn {
            background-color: #ff6b6b;
            color: white;
            font-size: 24px;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #ee5253;
            animation: pulse 1.5s infinite;
        }

        #start-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* å…¶ä»–å…ƒç´  (æ²¿ç”¨ä¸Šå€‹ç‰ˆæœ¬) */
        .timer-container {
            width: 100%; height: 15px; background-color: #dfe6e9; border-radius: 10px; margin-bottom: 15px; overflow: hidden; position: relative;
        }
        .timer-bar {
            height: 100%; width: 100%; background-color: #00b894; border-radius: 10px; transition: width 1s linear, background-color 0.5s;
        }
        .mascot { font-size: 70px; margin-bottom: 5px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); }
        .score-board { background-color: #ffeaa7; color: #d35400; padding: 8px 15px; border-radius: 15px; font-weight: bold; display: inline-block; margin-bottom: 10px; font-size: 18px; }
        .question { font-size: 52px; color: #2d3436; margin: 10px 0 20px 0; font-weight: 900; text-shadow: 2px 2px 0px #dfe6e9; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        button.option-btn { background-color: #74b9ff; border: none; border-radius: 15px; padding: 15px; font-size: 26px; color: white; cursor: pointer; box-shadow: 0 5px 0 #0984e3; font-family: inherit; }
        button.option-btn:active { transform: translateY(5px); box-shadow: none; }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .confetti { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 120px; opacity: 0; pointer-events: none; z-index: 5; }
        .show-star { animation: popStar 0.8s ease-out; }
        @keyframes popStar { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0); } 50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); } }

        /* ä½œè€… footer */
        .author-footer {
            margin-top: 18px;
            font-size: 12px;
            color: #b2bec3;
        }
        .author-footer a {
            color: #636e72;
            text-decoration: none;
            font-weight: 600;
        }
        .author-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div class="game-container" id="game-box">
        <div id="start-overlay">
            <div style="font-size: 60px; margin-bottom: 20px;">â°ğŸš€</div>
            <h2 style="color:#2d3436; margin-bottom: 10px;">ç¸½æŒ‘æˆ°æ™‚é–“ï¼š<span style="color:#ff6b6b">5 åˆ†é˜</span></h2>
            <p style="color:#636e72; font-size: 14px;">ç­”å° +20 åˆ†ï¼Œç­”éŒ¯æˆ–è¶…æ™‚ -10 åˆ†</p>
            <button id="start-btn" onclick="startGame()">é–‹å§‹æŒ‘æˆ°ï¼</button>
        </div>

        <div class="total-timer-board">
            ç¸½æŒ‘æˆ°æ™‚é–“: <span id="total-time">05:00</span>
        </div>

        <div class="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
        </div>

        <div class="mascot" id="mascot">ğŸ¦</div>
        <div class="confetti" id="star">ğŸŒŸ</div>
        
        <div class="score-board">ç¸½åˆ†æ•¸: <span id="score">0</span> åˆ†</div>
        
        <div class="question" id="question">? x ? = ?</div>
        
        <div class="options-grid" id="options">
        </div>

        <div style="height: 30px; margin-top:10px; font-weight:bold; color:#636e72" id="feedback">
            æ¯é¡Œæœ‰ 8 ç§’é˜ï¼
        </div>
        
        <button id="restart-btn" style="display:none; margin-top:20px; background-color: #ff6b6b;" onclick="window.location.reload()">é‡æ–°é–‹å§‹</button>

        <!-- ä½œè€…é€£çµ footer -->
        <div class="author-footer">
            Designed byï¼š<a href="#" target="_blank" rel="noopener noreferrer">Vartan Liu</a>
        </div>
    </div>

    <script>
        // --- è¨­å®šå¸¸æ•¸èˆ‡è®Šæ•¸ (å¯èª¿æ•´ç¸½æ™‚é–“) ---
        const TOTAL_TIME_MINUTES = 5; // <--- èª¿æ•´é€™å€‹æ•¸å­—ä¾†æ”¹è®Šç¸½æŒ‘æˆ°æ™‚é–“ (åˆ†é˜)
        const SCORE_CORRECT = 20;
        const SCORE_INCORRECT = -10;
        const maxTime = 8; // æ¯é¡Œç§’æ•¸

        let score = 0;
        let currentAnswer = 0;
        let timeLeft = maxTime;
        let timerInterval; // å€‹åˆ¥é¡Œç›®è¨ˆæ™‚å™¨
        
        let totalTimeSeconds = TOTAL_TIME_MINUTES * 60;
        let totalTimerInterval; // ç¸½æŒ‘æˆ°æ™‚é–“è¨ˆæ™‚å™¨
        let isGameRunning = false;

        // DOM å…ƒç´ 
        const questionEl = document.getElementById('question');
        const optionsEl = document.getElementById('options');
        const scoreEl = document.getElementById('score');
        const feedbackEl = document.getElementById('feedback');
        const mascotEl = document.getElementById('mascot');
        const starEl = document.getElementById('star');
        const timerBarEl = document.getElementById('timer-bar');
        const totalTimeEl = document.getElementById('total-time');
        const gameBox = document.getElementById('game-box');
        const restartBtn = document.getElementById('restart-btn');

        const mascots = { normal: "ğŸ‘©", happy: "ğŸ˜†", wrong: "ğŸ˜­", timeout: "â°" };

        // --- éŸ³æ•ˆç³»çµ± (Web Audio API - æ²¿ç”¨ä¸Šå€‹ç‰ˆæœ¬) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSound(type) {
            if (!audioCtx || !isGameRunning) return;
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(660, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong' || type === 'timeout') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- ç¸½è¨ˆæ™‚å™¨é‚è¼¯ ---
        function startTotalTimer() {
            clearInterval(totalTimerInterval);
            updateTotalTimeDisplay();
            
            totalTimerInterval = setInterval(() => {
                totalTimeSeconds--;
                updateTotalTimeDisplay();

                if (totalTimeSeconds <= 0) {
                    clearInterval(totalTimerInterval);
                    handleGameOver();
                }
            }, 1000);
        }

        function updateTotalTimeDisplay() {
            const minutes = Math.floor(totalTimeSeconds / 60);
            const seconds = totalTimeSeconds % 60;
            const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            totalTimeEl.textContent = timeString;
            
            // ç¸½æ™‚é–“å‰©é¤˜ 1 åˆ†é˜æ™‚è®Šç´…ï¼Œå¢åŠ ç·Šå¼µæ„Ÿ
            if (totalTimeSeconds <= 60 && totalTimeSeconds > 0) {
                totalTimeEl.parentElement.style.backgroundColor = '#ff6b6b'; // ç´…è‰²èƒŒæ™¯
                totalTimeEl.parentElement.style.boxShadow = '0 4px 0 #ee5253';
            }
        }

        function handleGameOver() {
            isGameRunning = false;
            clearInterval(timerInterval);
            disableOptions();
            
            // è¦–è¦ºèˆ‡è½è¦ºå›é¥‹
            playSound('timeout'); 
            questionEl.textContent = "â±ï¸ æŒ‘æˆ°çµæŸï¼";
            feedbackEl.textContent = `æ­å–œä½ å®ŒæˆæŒ‘æˆ°ï¼æœ€çµ‚åˆ†æ•¸æ˜¯ ${score} åˆ†ï¼`;
            feedbackEl.style.color = "#3498db";
            mascotEl.textContent = "ğŸ†";
            
            restartBtn.style.display = 'block'; // é¡¯ç¤ºé‡æ–°é–‹å§‹æŒ‰éˆ•
        }

        // --- éŠæˆ²æµç¨‹æ§åˆ¶ ---
        function startGame() {
            initAudio();
            document.getElementById('start-overlay').style.display = 'none';
            
            isGameRunning = true;
            score = 0;
            scoreEl.textContent = score;
            totalTimeSeconds = TOTAL_TIME_MINUTES * 60; // é‡ç½®ç¸½æ™‚é–“
            startTotalTimer();
            generateQuestion();
        }

        function startQuestionTimer() {
            clearInterval(timerInterval);
            timeLeft = maxTime;
            updateTimerVisual();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerVisual();

                if (timeLeft <= 0) {
                    handleTimeout();
                }
            }, 1000);
        }

        function updateTimerVisual() {
            const percentage = (timeLeft / maxTime) * 100;
            timerBarEl.style.width = percentage + "%";
            
            if (percentage > 60) timerBarEl.style.backgroundColor = "#00b894";
            else if (percentage > 30) timerBarEl.style.backgroundColor = "#fdcb6e";
            else timerBarEl.style.backgroundColor = "#ff7675";
        }

        function handleTimeout() {
            if (!isGameRunning) return;

            clearInterval(timerInterval);
            playSound('wrong'); // è¶…æ™‚ä¹Ÿç®—éŒ¯
            
            score += SCORE_INCORRECT; // æ‰£ 10 åˆ†
            scoreEl.textContent = score;

            mascotEl.textContent = mascots.timeout;
            feedbackEl.textContent = `æ™‚é–“åˆ°ï¼å¤ªæ…¢å›‰ï¼Œæ‰£ 10 åˆ†ã€‚ç­”æ¡ˆæ˜¯ ${currentAnswer}`;
            feedbackEl.style.color = "#d63031";
            gameBox.classList.add('shake');
            
            disableOptions();

            setTimeout(() => {
                gameBox.classList.remove('shake');
                generateQuestion();
            }, 1500);
        }
        
        function generateQuestion() {
            if (!isGameRunning) return; // éŠæˆ²çµæŸä¸ç”¢ç”Ÿæ–°é¡Œ

            clearInterval(timerInterval);
            mascotEl.textContent = mascots.normal;
            feedbackEl.textContent = "é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼";
            feedbackEl.style.color = "#636e72";
            restartBtn.style.display = 'none';
            
            const num1 = Math.floor(Math.random() * 9) + 1;
            const num2 = Math.floor(Math.random() * 9) + 1;
            currentAnswer = num1 * num2;
            questionEl.textContent = `${num1} x ${num2} = ?`;

            generateOptions(currentAnswer); 
            startQuestionTimer();
        }

        function generateOptions(correct) {
            optionsEl.innerHTML = '';
            let options = [correct];
            while (options.length < 4) {
                let offset = Math.floor(Math.random() * 10) - 5;
                let wrong = correct + offset;
                if (wrong > 0 && !options.includes(wrong)) {
                    options.push(wrong);
                } else {
                    let randomWrong = Math.floor(Math.random() * 81) + 1;
                    if (!options.includes(randomWrong)) options.push(randomWrong);
                }
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(num => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = num;
                btn.onclick = () => checkAnswer(num, btn);
                optionsEl.appendChild(btn);
            });
        }
        
        // --- æ ¸å¿ƒæª¢æŸ¥ç­”æ¡ˆèˆ‡åˆ†æ•¸é‚è¼¯ (å·²èª¿æ•´) ---
        function checkAnswer(selected, btnElement) {
            if (!isGameRunning) return;
            
            clearInterval(timerInterval); 
            disableOptions(); // æš«æ™‚é–å®šæ‰€æœ‰é¸é …é¿å…äºŒæ¬¡é»æ“Š

            if (selected === currentAnswer) {
                // ç­”å°: +20 åˆ†
                playSound('correct');
                score += SCORE_CORRECT;
                scoreEl.textContent = score;
                feedbackEl.textContent = `å¤ªæ£’äº†ï¼ç­”å°äº†ï¼ŒåŠ  ${SCORE_CORRECT} åˆ†ï¼`;
                feedbackEl.style.color = "#00b894";
                mascotEl.textContent = mascots.happy;
                
                starEl.classList.remove('show-star');
                void starEl.offsetWidth;
                starEl.classList.add('show-star');

                setTimeout(generateQuestion, 1000);
            } else {
                // ç­”éŒ¯: -10 åˆ†
                playSound('wrong');
                score += SCORE_INCORRECT; // æ‰£åˆ†
                scoreEl.textContent = score;
                feedbackEl.textContent = `å–”å–”ï¼Œä¸å°å–”ï¼Œæ‰£ ${Math.abs(SCORE_INCORRECT)} åˆ†ã€‚ç­”æ¡ˆæ˜¯ ${currentAnswer}`;
                feedbackEl.style.color = "#d63031";
                mascotEl.textContent = mascots.wrong;
                gameBox.classList.add('shake');
                btnElement.style.backgroundColor = "#ff7675"; // æ¨™ç¤ºéŒ¯èª¤æŒ‰éˆ•

                setTimeout(() => {
                    gameBox.classList.remove('shake');
                    generateQuestion();
                }, 1500);
            }
        }

        function disableOptions() {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(btn => btn.disabled = true);
        }

        // é¦–æ¬¡è¼‰å…¥é¡¯ç¤ºç¸½æ™‚é–“
        updateTotalTimeDisplay();

    </script>
</body>
</html>

